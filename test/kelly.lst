0000                          ;***********************************************************************
0000                          ; MICROCOSM ASSOCIATES  8080/8085 CPU DIAGNOSTIC VERSION 1.0  (C) 1980
0000                          ;***********************************************************************
0000                          ; Load into virtual altair with: ALTAIR L=TEST.HEX
0000                          ; Then press F2 to view screen, and 'G' to execute the test.
0000                          ; 
0000                          ;DONATED TO THE "SIG/M" CP/M USER'S GROUP BY:
0000                          ;KELLY SMITH, MICROCOSM ASSOCIATES
0000                          ;3055 WACO AVENUE
0000                          ;SIMI VALLEY, CALIFORNIA, 93065
0000                          ;(805) 527-9321 (MODEM, CP/M-NET (TM))
0000                          ;(805) 527-0518 (VERBAL)
0000                          ; 
0000                          .CPU   8080   
0005                          .ORG   5   
0005   C9                     RET   
0100                          .ORG   00100H   
0100                          .ENT   $   
0100   21 09 01               LXI   H,LOLZ   
0103   31 BA 07               LXI   SP,STACK   
0106                          ;CALL        MSG
0106   C3 C1 01               JMP   CPU   ;JUMP TO 8080 CPU DIAGNOSTIC
0109                          ; 
0109   4D 49 43 52 4F 43 4F 53 4D 20 41 53 53 4F 43 49 41 54 45 53 20 38 30 38 30 2F 38 30 38 35 20 43 50 55 20 44 49 41 47 4E 4F 53 54 49 43 20 56 45 52 53 49 4F 4E 20 31 2E 30 20 20 28 43 29 20 31 39 38 30 0D 0A 24 LOLZ:   DB   "MICROCOSM ASSOCIATES 8080/8085 CPU DIAGNOSTIC VERSION 1.0  (C) 1980",0dh,0ah,24h   
014F                          ; 
014F                BDOS:     EQU   00005H   
014F   C3 00 00     WBOOT:    JMP   0   
0152                          ; 
0152                          ;MESSAGE OUTPUT ROUTINE
0152                          ; 
0152   7E           MSG:      MOV   A,M   ; Get data
0153   FE 24                  CPI   '$'   ; End?
0155   C8                     RZ   
0156   CD 5D 01               CALL   PCHAR   ; Output
0159   23                     INX   H   ; Next
015A   C3 52 01               JMP   MSG   ; Do all
015D                          ; 
015D                          ; 
015D                          ;CHARACTER OUTPUT ROUTINE
015D                          ; 
015D   F5           PCHAR:    PUSH   PSW   
015E   D5                     PUSH   D   
015F   E5                     PUSH   H   
0160   5F                     MOV   E,A   
0161   0E 02                  MVI   C,2   
0163   CD 05 00               CALL   BDOS   
0166   E1                     POP   H   
0167   D1                     POP   D   
0168   F1                     POP   PSW   
0169   C9                     RET   
016A                          ; 
016A                          ; 
016A                          ; 
016A   F5           BYTEO:    PUSH   PSW   
016B   CD 7A 01               CALL   BYTO1   
016E   5F                     MOV   E,A   
016F   CD 5D 01               CALL   PCHAR   
0172   F1                     POP   PSW   
0173   CD 7E 01               CALL   BYTO2   
0176   5F                     MOV   E,A   
0177   C3 5D 01               JMP   PCHAR   
017A   0F           BYTO1:    RRC   
017B   0F                     RRC   
017C   0F                     RRC   
017D   0F                     RRC   
017E   E6 0F        BYTO2:    ANI   0FH   
0180   FE 0A                  CPI   0AH   
0182   FA 87 01               JM   BYTO3   
0185   C6 07                  ADI   7   
0187   C6 30        BYTO3:    ADI   30H   
0189   C9                     RET   
018A                          ; 
018A                          ; 
018A                          ; 
018A                          ;************************************************************
018A                          ;           MESSAGE TABLE FOR OPERATIONAL CPU TEST
018A                          ;************************************************************
018A                          ; 
018A   0D 0A        OKCPU:    DB   0DH,0AH   
018C   43 50 55 20 49 53 20 4F 50 45 52 41 54 49 4F 4E 41 4C 24 DB   "CPU IS OPERATIONAL$"   
019F                          ; 
019F   0D 0A        NGCPU:    DB   0DH,0AH   
01A1   20 43 50 55 20 48 41 53 20 46 41 49 4C 45 44 21 20 20 20 20 45 52 52 4F 52 20 45 58 49 54 3D 24 DB   " CPU HAS FAILED!    ERROR EXIT=$"   
01C1                          ; 
01C1                          ; 
01C1                          ; 
01C1                          ;************************************************************
01C1                          ;                8080/8085 CPU TEST/DIAGNOSTIC
01C1                          ;************************************************************
01C1                          ; 
01C1                          ;NOTE: (1) PROGRAM ASSUMES "CALL",AND "LXI SP" INSTRUCTIONS WORK!
01C1                          ; 
01C1                          ;      (2) INSTRUCTIONS NOT TESTED ARE "HLT","DI","EI",
01C1                          ;          AND "RST 0" THRU "RST 7"
01C1                          ; 
01C1                          ; 
01C1                          ; 
01C1                          ;TEST JUMP INSTRUCTIONS AND FLAGS
01C1                          ; 
01C1   31 BA 07     CPU:      LXI   SP,STACK   ;SET THE STACK POINTER
01C4   E6 00                  ANI   0   ;INITIALIZE A REG. AND CLEAR ALL FLAGS
01C6   CA CC 01               JZ   J010   ;TEST "JZ"
01C9   CD 9F 06               CALL   CPUER   
01CC   D2 D2 01     J010:     JNC   J020   ;TEST "JNC"
01CF   CD 9F 06               CALL   CPUER   
01D2   EA D8 01     J020:     JPE   J030   ;TEST "JPE"
01D5   CD 9F 06               CALL   CPUER   
01D8   F2 DE 01     J030:     JP   J040   ;TEST "JP"
01DB   CD 9F 06               CALL   CPUER   
01DE   C2 ED 01     J040:     JNZ   J050   ;TEST "JNZ"
01E1   DA ED 01               JC   J050   ;TEST "JC"
01E4   E2 ED 01               JPO   J050   ;TEST "JPO"
01E7   FA ED 01               JM   J050   ;TEST "JM"
01EA   C3 F0 01               JMP   J060   ;TEST "JMP" (IT'S A LITTLE LATE,BUT WHAT THE HELL!
01ED   CD 9F 06     J050:     CALL   CPUER   
01F0   C6 06        J060:     ADI   6   ;A=6,C=0,P=1,S=0,Z=0
01F2   C2 F8 01               JNZ   J070   ;TEST "JNZ"
01F5   CD 9F 06               CALL   CPUER   
01F8   DA 01 02     J070:     JC   J080   ;TEST "JC"
01FB   E2 01 02               JPO   J080   ;TEST "JPO"
01FE   F2 04 02               JP   J090   ;TEST "JP"
0201   CD 9F 06     J080:     CALL   CPUER   
0204   C6 70        J090:     ADI   070H   ;A=76H,C=0,P=0,S=0,Z=0
0206   E2 0C 02               JPO   J100   ;TEST "JPO"
0209   CD 9F 06               CALL   CPUER   
020C   FA 15 02     J100:     JM   J110   ;TEST "JM"
020F   CA 15 02               JZ   J110   ;TEST "JZ"
0212   D2 18 02               JNC   J120   ;TEST "JNC"
0215   CD 9F 06     J110:     CALL   CPUER   
0218   C6 81        J120:     ADI   081H   ;A=F7H,C=0,P=0,S=1,Z=0
021A   FA 20 02               JM   J130   ;TEST "JM"
021D   CD 9F 06               CALL   CPUER   
0220   CA 29 02     J130:     JZ   J140   ;TEST "JZ"
0223   DA 29 02               JC   J140   ;TEST "JC"
0226   E2 2C 02               JPO   J150   ;TEST "JPO"
0229   CD 9F 06     J140:     CALL   CPUER   
022C   C6 FE        J150:     ADI   0FEH   ;A=F5H,C=1,P=1,S=1,Z=0
022E   DA 34 02               JC   J160   ;TEST "JC"
0231   CD 9F 06               CALL   CPUER   
0234   CA 3D 02     J160:     JZ   J170   ;TEST "JZ"
0237   E2 3D 02               JPO   J170   ;TEST "JPO"
023A   FA 40 02               JM   AIMM   ;TEST "JM"
023D   CD 9F 06     J170:     CALL   CPUER   
0240                          ; 
0240                          ; 
0240                          ; 
0240                          ;TEST ACCUMULATOR IMMEDIATE INSTRUCTIONS
0240                          ; 
0240   FE 00        AIMM:     CPI   0   ;A=F5H,C=0,Z=0
0242   DA 58 02               JC   CPIE   ;TEST "CPI" FOR RE-SET CARRY
0245   CA 58 02               JZ   CPIE   ;TEST "CPI" FOR RE-SET ZERO
0248   FE F5                  CPI   0F5H   ;A=F5H,C=0,Z=1
024A   DA 58 02               JC   CPIE   ;TEST "CPI" FOR RE-SET CARRY ("ADI")
024D   C2 58 02               JNZ   CPIE   ;TEST "CPI" FOR RE-SET ZERO
0250   FE FF                  CPI   0FFH   ;A=F5H,C=1,Z=0
0252   CA 58 02               JZ   CPIE   ;TEST "CPI" FOR RE-SET ZERO
0255   DA 5B 02               JC   ACII   ;TEST "CPI" FOR SET CARRY
0258   CD 9F 06     CPIE:     CALL   CPUER   
025B   CE 0A        ACII:     ACI   00AH   ;A=F5H+0AH+CARRY(1)=0,C=1
025D   CE 0A                  ACI   00AH   ;A=0+0AH+CARRY(0)=0BH,C=0
025F   FE 0B                  CPI   00BH   
0261   CA 67 02               JZ   SUII   ;TEST "ACI"
0264   CD 9F 06               CALL   CPUER   
0267   D6 0C        SUII:     SUI   00CH   ;A=FFH,C=0
0269   D6 0F                  SUI   00FH   ;A=F0H,C=1
026B   FE F0                  CPI   0F0H   
026D   CA 73 02               JZ   SBII   ;TEST "SUI"
0270   CD 9F 06               CALL   CPUER   
0273   DE F1        SBII:     SBI   0F1H   ;A=F0H-0F1H-CARRY(0)=FFH,C=1
0275   DE 0E                  SBI   00EH   ;A=FFH-OEH-CARRY(1)=F0H,C=0
0277   FE F0                  CPI   0F0H   
0279   CA 7F 02               JZ   ANII   ;TEST "SBI"
027C   CD 9F 06               CALL   CPUER   
027F   E6 55        ANII:     ANI   055H   ;A=F0H<AND>55H=50H,C=0,P=1,S=0,Z=0
0281   FE 50                  CPI   050H   
0283   CA 89 02               JZ   ORII   ;TEST "ANI"
0286   CD 9F 06               CALL   CPUER   
0289   F6 3A        ORII:     ORI   03AH   ;A=50H<OR>3AH=7AH,C=0,P=0,S=0,Z=0
028B   FE 7A                  CPI   07AH   
028D   CA 93 02               JZ   XRII   ;TEST "ORI"
0290   CD 9F 06               CALL   CPUER   
0293   EE 0F        XRII:     XRI   00FH   ;A=7AH<XOR>0FH=75H,C=0,P=0,S=0,Z=0
0295   FE 75                  CPI   075H   
0297   CA 9D 02               JZ   C010   ;TEST "XRI"
029A   CD 9F 06               CALL   CPUER   
029D                          ; 
029D                          ; 
029D                          ; 
029D                          ;TEST CALLS AND RETURNS
029D                          ; 
029D   E6 00        C010:     ANI   000H   ;A=0,C=0,P=1,S=0,Z=1
029F   DC 9F 06               CC   CPUER   ;TEST "CC"
02A2   E4 9F 06               CPO   CPUER   ;TEST "CPO"
02A5   FC 9F 06               CM   CPUER   ;TEST "CM"
02A8   C4 9F 06               CNZ   CPUER   ;TEST "CNZ"
02AB   FE 00                  CPI   000H   
02AD   CA B3 02               JZ   C020   ;A=0,C=0,P=0,S=0,Z=1
02B0   CD 9F 06               CALL   CPUER   
02B3   D6 77        C020:     SUI   077H   ;A=89H,C=1,P=0,S=1,Z=0
02B5   D4 9F 06               CNC   CPUER   ;TEST "CNC"
02B8   EC 9F 06               CPE   CPUER   ;TEST "CPE"
02BB   F4 9F 06               CP   CPUER   ;TEST "CP"
02BE   CC 9F 06               CZ   CPUER   ;TEST "CZ"
02C1   FE 89                  CPI   089H   
02C3   CA C9 02               JZ   C030   ;TEST FOR "CALLS" TAKING BRANCH
02C6   CD 9F 06               CALL   CPUER   
02C9   E6 FF        C030:     ANI   0FFH   ;SET FLAGS BACK!
02CB   E4 D6 02               CPO   CPOI   ;TEST "CPO"
02CE   FE D9                  CPI   0D9H   
02D0   CA 33 03               JZ   MOVI   ;TEST "CALL" SEQUENCE SUCCESS
02D3   CD 9F 06               CALL   CPUER   
02D6   E8           CPOI:     RPE   ;TEST "RPE"
02D7   C6 10                  ADI   010H   ;A=99H,C=0,P=0,S=1,Z=0
02D9   EC E2 02               CPE   CPEI   ;TEST "CPE"
02DC   C6 02                  ADI   002H   ;A=D9H,C=0,P=0,S=1,Z=0
02DE   E0                     RPO   ;TEST "RPO"
02DF   CD 9F 06               CALL   CPUER   
02E2   E0           CPEI:     RPO   ;TEST "RPO"
02E3   C6 20                  ADI   020H   ;A=B9H,C=0,P=0,S=1,Z=0
02E5   FC EE 02               CM   CMI   ;TEST "CM"
02E8   C6 04                  ADI   004H   ;A=D7H,C=0,P=1,S=1,Z=0
02EA   E8                     RPE   ;TEST "RPE"
02EB   CD 9F 06               CALL   CPUER   
02EE   F0           CMI:      RP   ;TEST "RP"
02EF   C6 80                  ADI   080H   ;A=39H,C=1,P=1,S=0,Z=0
02F1   F4 FA 02               CP   TCPI   ;TEST "CP"
02F4   C6 80                  ADI   080H   ;A=D3H,C=0,P=0,S=1,Z=0
02F6   F8                     RM   ;TEST "RM"
02F7   CD 9F 06               CALL   CPUER   
02FA   F8           TCPI:     RM   ;TEST "RM"
02FB   C6 40                  ADI   040H   ;A=79H,C=0,P=0,S=0,Z=0
02FD   D4 06 03               CNC   CNCI   ;TEST "CNC"
0300   C6 40                  ADI   040H   ;A=53H,C=0,P=1,S=0,Z=0
0302   F0                     RP   ;TEST "RP"
0303   CD 9F 06               CALL   CPUER   
0306   D8           CNCI:     RC   ;TEST "RC"
0307   C6 8F                  ADI   08FH   ;A=08H,C=1,P=0,S=0,Z=0
0309   DC 12 03               CC   CCI   ;TEST "CC"
030C   D6 02                  SUI   002H   ;A=13H,C=0,P=0,S=0,Z=0
030E   D0                     RNC   ;TEST "RNC"
030F   CD 9F 06               CALL   CPUER   
0312   D0           CCI:      RNC   ;TEST "RNC"
0313   C6 F7                  ADI   0F7H   ;A=FFH,C=0,P=1,S=1,Z=0
0315   C4 1E 03               CNZ   CNZI   ;TEST "CNZ"
0318   C6 FE                  ADI   0FEH   ;A=15H,C=1,P=0,S=0,Z=0
031A   D8                     RC   ;TEST "RC"
031B   CD 9F 06               CALL   CPUER   
031E   C8           CNZI:     RZ   ;TEST "RZ"
031F   C6 01                  ADI   001H   ;A=00H,C=1,P=1,S=0,Z=1
0321   CC 2A 03               CZ   CZI   ;TEST "CZ"
0324   C6 D0                  ADI   0D0H   ;A=17H,C=1,P=1,S=0,Z=0
0326   C0                     RNZ   ;TEST "RNZ"
0327   CD 9F 06               CALL   CPUER   
032A   C0           CZI:      RNZ   ;TEST "RNZ"
032B   C6 47                  ADI   047H   ;A=47H,C=0,P=1,S=0,Z=0
032D   FE 47                  CPI   047H   ;A=47H,C=0,P=1,S=0,Z=1
032F   C8                     RZ   ;TEST "RZ"
0330   CD 9F 06               CALL   CPUER   
0333                          ; 
0333                          ; 
0333                          ; 
0333                          ;TEST "MOV","INR",AND "DCR" INSTRUCTIONS
0333                          ; 
0333   3E 77        MOVI:     MVI   A,077H   
0335   3C                     INR   A   
0336   47                     MOV   B,A   
0337   04                     INR   B   
0338   48                     MOV   C,B   
0339   0D                     DCR   C   
033A   51                     MOV   D,C   
033B   5A                     MOV   E,D   
033C   63                     MOV   H,E   
033D   6C                     MOV   L,H   
033E   7D                     MOV   A,L   ;TEST "MOV" A,L,H,E,D,C,B,A
033F   3D                     DCR   A   
0340   4F                     MOV   C,A   
0341   59                     MOV   E,C   
0342   6B                     MOV   L,E   
0343   45                     MOV   B,L   
0344   50                     MOV   D,B   
0345   62                     MOV   H,D   
0346   7C                     MOV   A,H   ;TEST "MOV" A,H,D,B,L,E,C,A
0347   57                     MOV   D,A   
0348   14                     INR   D   
0349   6A                     MOV   L,D   
034A   4D                     MOV   C,L   
034B   0C                     INR   C   
034C   61                     MOV   H,C   
034D   44                     MOV   B,H   
034E   05                     DCR   B   
034F   58                     MOV   E,B   
0350   7B                     MOV   A,E   ;TEST "MOV" A,E,B,H,C,L,D,A
0351   5F                     MOV   E,A   
0352   1C                     INR   E   
0353   43                     MOV   B,E   
0354   60                     MOV   H,B   
0355   24                     INR   H   
0356   4C                     MOV   C,H   
0357   69                     MOV   L,C   
0358   55                     MOV   D,L   
0359   15                     DCR   D   
035A   7A                     MOV   A,D   ;TEST "MOV" A,D,L,C,H,B,E,A
035B   67                     MOV   H,A   
035C   25                     DCR   H   
035D   54                     MOV   D,H   
035E   42                     MOV   B,D   
035F   68                     MOV   L,B   
0360   2C                     INR   L   
0361   5D                     MOV   E,L   
0362   1D                     DCR   E   
0363   4B                     MOV   C,E   
0364   79                     MOV   A,C   ;TEST "MOV" A,C,E,L,B,D,H,A
0365   6F                     MOV   L,A   
0366   2D                     DCR   L   
0367   65                     MOV   H,L   
0368   5C                     MOV   E,H   
0369   53                     MOV   D,E   
036A   4A                     MOV   C,D   
036B   41                     MOV   B,C   
036C   78                     MOV   A,B   
036D   FE 77                  CPI   077H   
036F   C4 9F 06               CNZ   CPUER   ;TEST "MOV" A,B,C,D,E,H,L,A
0372                          ; 
0372                          ; 
0372                          ; 
0372                          ;TEST ARITHMETIC AND LOGIC INSTRUCTIONS
0372                          ; 
0372   AF                     XRA   A   
0373   06 01                  MVI   B,001H   
0375   0E 03                  MVI   C,003H   
0377   16 07                  MVI   D,007H   
0379   1E 0F                  MVI   E,00FH   
037B   26 1F                  MVI   H,01FH   
037D   2E 3F                  MVI   L,03FH   
037F   80                     ADD   B   
0380   81                     ADD   C   
0381   82                     ADD   D   
0382   83                     ADD   E   
0383   84                     ADD   H   
0384   85                     ADD   L   
0385   87                     ADD   A   
0386   FE F0                  CPI   0F0H   
0388   C4 9F 06               CNZ   CPUER   ;TEST "ADD" B,C,D,E,H,L,A
038B   90                     SUB   B   
038C   91                     SUB   C   
038D   92                     SUB   D   
038E   93                     SUB   E   
038F   94                     SUB   H   
0390   95                     SUB   L   
0391   FE 78                  CPI   078H   
0393   C4 9F 06               CNZ   CPUER   ;TEST "SUB" B,C,D,E,H,L
0396   97                     SUB   A   
0397   C4 9F 06               CNZ   CPUER   ;TEST "SUB" A
039A   3E 80                  MVI   A,080H   
039C   87                     ADD   A   
039D   06 01                  MVI   B,001H   
039F   0E 02                  MVI   C,002H   
03A1   16 03                  MVI   D,003H   
03A3   1E 04                  MVI   E,004H   
03A5   26 05                  MVI   H,005H   
03A7   2E 06                  MVI   L,006H   
03A9   88                     ADC   B   
03AA   06 80                  MVI   B,080H   
03AC   80                     ADD   B   
03AD   80                     ADD   B   
03AE   89                     ADC   C   
03AF   80                     ADD   B   
03B0   80                     ADD   B   
03B1   8A                     ADC   D   
03B2   80                     ADD   B   
03B3   80                     ADD   B   
03B4   8B                     ADC   E   
03B5   80                     ADD   B   
03B6   80                     ADD   B   
03B7   8C                     ADC   H   
03B8   80                     ADD   B   
03B9   80                     ADD   B   
03BA   8D                     ADC   L   
03BB   80                     ADD   B   
03BC   80                     ADD   B   
03BD   8F                     ADC   A   
03BE   FE 37                  CPI   037H   
03C0   C4 9F 06               CNZ   CPUER   ;TEST "ADC" B,C,D,E,H,L,A
03C3   3E 80                  MVI   A,080H   
03C5   87                     ADD   A   
03C6   06 01                  MVI   B,001H   
03C8   98                     SBB   B   
03C9   06 FF                  MVI   B,0FFH   
03CB   80                     ADD   B   
03CC   99                     SBB   C   
03CD   80                     ADD   B   
03CE   9A                     SBB   D   
03CF   80                     ADD   B   
03D0   9B                     SBB   E   
03D1   80                     ADD   B   
03D2   9C                     SBB   H   
03D3   80                     ADD   B   
03D4   9D                     SBB   L   
03D5   FE E0                  CPI   0E0H   
03D7   C4 9F 06               CNZ   CPUER   ;TEST "SBB" B,C,D,E,H,L
03DA   3E 80                  MVI   A,080H   
03DC   87                     ADD   A   
03DD   9F                     SBB   A   
03DE   FE FF                  CPI   0FFH   
03E0   C4 9F 06               CNZ   CPUER   ;TEST "SBB" A
03E3   3E FF                  MVI   A,0FFH   
03E5   06 FE                  MVI   B,0FEH   
03E7   0E FC                  MVI   C,0FCH   
03E9   16 EF                  MVI   D,0EFH   
03EB   1E 7F                  MVI   E,07FH   
03ED   26 F4                  MVI   H,0F4H   
03EF   2E BF                  MVI   L,0BFH   
03F1   A7                     ANA   A   
03F2   A1                     ANA   C   
03F3   A2                     ANA   D   
03F4   A3                     ANA   E   
03F5   A4                     ANA   H   
03F6   A5                     ANA   L   
03F7   A7                     ANA   A   
03F8   FE 24                  CPI   024H   
03FA   C4 9F 06               CNZ   CPUER   ;TEST "ANA" B,C,D,E,H,L,A
03FD   AF                     XRA   A   
03FE   06 01                  MVI   B,001H   
0400   0E 02                  MVI   C,002H   
0402   16 04                  MVI   D,004H   
0404   1E 08                  MVI   E,008H   
0406   26 10                  MVI   H,010H   
0408   2E 20                  MVI   L,020H   
040A   B0                     ORA   B   
040B   B1                     ORA   C   
040C   B2                     ORA   D   
040D   B3                     ORA   E   
040E   B4                     ORA   H   
040F   B5                     ORA   L   
0410   B7                     ORA   A   
0411   FE 3F                  CPI   03FH   
0413   C4 9F 06               CNZ   CPUER   ;TEST "ORA" B,C,D,E,H,L,A
0416   3E 00                  MVI   A,000H   
0418   26 8F                  MVI   H,08FH   
041A   2E 4F                  MVI   L,04FH   
041C   A8                     XRA   B   
041D   A9                     XRA   C   
041E   AA                     XRA   D   
041F   AB                     XRA   E   
0420   AC                     XRA   H   
0421   AD                     XRA   L   
0422   FE CF                  CPI   0CFH   
0424   C4 9F 06               CNZ   CPUER   ;TEST "XRA" B,C,D,E,H,L
0427   AF                     XRA   A   
0428   C4 9F 06               CNZ   CPUER   ;TEST "XRA" A
042B   06 44                  MVI   B,044H   
042D   0E 45                  MVI   C,045H   
042F   16 46                  MVI   D,046H   
0431   1E 47                  MVI   E,047H   
0433   26 06                  MVI   H,(TEMP0/0FFH)   ;HIGH BYTE OF TEST MEMORY LOCATION
0435   2E BC                  MVI   L,(TEMP0&0FFH)   ;LOW BYTE OF TEST MEMORY LOCATION
0437   70                     MOV   M,B   
0438   06 00                  MVI   B,000H   
043A   46                     MOV   B,M   
043B   3E 44                  MVI   A,044H   
043D   B8                     CMP   B   
043E   C4 9F 06               CNZ   CPUER   ;TEST "MOV" M,B AND B,M
0441   72                     MOV   M,D   
0442   16 00                  MVI   D,000H   
0444   56                     MOV   D,M   
0445   3E 46                  MVI   A,046H   
0447   BA                     CMP   D   
0448   C4 9F 06               CNZ   CPUER   ;TEST "MOV" M,D AND D,M
044B   73                     MOV   M,E   
044C   1E 00                  MVI   E,000H   
044E   5E                     MOV   E,M   
044F   3E 47                  MVI   A,047H   
0451   BB                     CMP   E   
0452   C4 9F 06               CNZ   CPUER   ;TEST "MOV" M,E AND E,M
0455   74                     MOV   M,H   
0456   26 06                  MVI   H,(TEMP0/0FFH)   
0458   2E BC                  MVI   L,(TEMP0&0FFH)   
045A   66                     MOV   H,M   
045B   3E 06                  MVI   A,(TEMP0/0FFH)   
045D   BC                     CMP   H   
045E   C4 9F 06               CNZ   CPUER   ;TEST "MOV" M,H AND H,M
0461   75                     MOV   M,L   
0462   26 06                  MVI   H,(TEMP0/0FFH)   
0464   2E BC                  MVI   L,(TEMP0&0FFH)   
0466   6E                     MOV   L,M   
0467   3E BC                  MVI   A,(TEMP0&0FFH)   
0469   BD                     CMP   L   
046A   C4 9F 06               CNZ   CPUER   ;TEST "MOV" M,L AND L,M
046D   26 06                  MVI   H,(TEMP0/0FFH)   
046F   2E BC                  MVI   L,(TEMP0&0FFH)   
0471   3E 32                  MVI   A,032H   
0473   77                     MOV   M,A   
0474   BE                     CMP   M   
0475   C4 9F 06               CNZ   CPUER   ;TEST "MOV" M,A
0478   86                     ADD   M   
0479   FE 64                  CPI   064H   
047B   C4 9F 06               CNZ   CPUER   ;TEST "ADD" M
047E   AF                     XRA   A   
047F   7E                     MOV   A,M   
0480   FE 32                  CPI   032H   
0482   C4 9F 06               CNZ   CPUER   ;TEST "MOV" A,M
0485   26 06                  MVI   H,(TEMP0/0FFH)   
0487   2E BC                  MVI   L,(TEMP0&0FFH)   
0489   7E                     MOV   A,M   
048A   96                     SUB   M   
048B   C4 9F 06               CNZ   CPUER   ;TEST "SUB" M
048E   3E 80                  MVI   A,080H   
0490   87                     ADD   A   
0491   8E                     ADC   M   
0492   FE 33                  CPI   033H   
0494   C4 9F 06               CNZ   CPUER   ;TEST "ADC" M
0497   3E 80                  MVI   A,080H   
0499   87                     ADD   A   
049A   9E                     SBB   M   
049B   FE CD                  CPI   0CDH   
049D   C4 9F 06               CNZ   CPUER   ;TEST "SBB" M
04A0   A6                     ANA   M   
04A1   C4 9F 06               CNZ   CPUER   ;TEST "ANA" M
04A4   3E 25                  MVI   A,025H   
04A6   B6                     ORA   M   
04A7   FE 37                  CPI   037H   
04A9   C4 9F 06               CNZ   CPUER   ;TEST "ORA" M
04AC   AE                     XRA   M   
04AD   FE 05                  CPI   005H   
04AF   C4 9F 06               CNZ   CPUER   ;TEST "XRA" M
04B2   36 55                  MVI   M,055H   
04B4   34                     INR   M   
04B5   35                     DCR   M   
04B6   86                     ADD   M   
04B7   FE 5A                  CPI   05AH   
04B9   C4 9F 06               CNZ   CPUER   ;TEST "INR","DCR",AND "MVI" M
04BC   01 FF 12               LXI   B,12FFH   
04BF   11 FF 12               LXI   D,12FFH   
04C2   21 FF 12               LXI   H,12FFH   
04C5   03                     INX   B   
04C6   13                     INX   D   
04C7   23                     INX   H   
04C8   3E 13                  MVI   A,013H   
04CA   B8                     CMP   B   
04CB   C4 9F 06               CNZ   CPUER   ;TEST "LXI" AND "INX" B
04CE   BA                     CMP   D   
04CF   C4 9F 06               CNZ   CPUER   ;TEST "LXI" AND "INX" D
04D2   BC                     CMP   H   
04D3   C4 9F 06               CNZ   CPUER   ;TEST "LXI" AND "INX" H
04D6   3E 00                  MVI   A,000H   
04D8   B9                     CMP   C   
04D9   C4 9F 06               CNZ   CPUER   ;TEST "LXI" AND "INX" B
04DC   BB                     CMP   E   
04DD   C4 9F 06               CNZ   CPUER   ;TEST "LXI" AND "INX" D
04E0   BD                     CMP   L   
04E1   C4 9F 06               CNZ   CPUER   ;TEST "LXI" AND "INX" H
04E4   0B                     DCX   B   
04E5   1B                     DCX   D   
04E6   2B                     DCX   H   
04E7   3E 12                  MVI   A,012H   
04E9   B8                     CMP   B   
04EA   C4 9F 06               CNZ   CPUER   ;TEST "DCX" B
04ED   BA                     CMP   D   
04EE   C4 9F 06               CNZ   CPUER   ;TEST "DCX" D
04F1   BC                     CMP   H   
04F2   C4 9F 06               CNZ   CPUER   ;TEST "DCX" H
04F5   3E FF                  MVI   A,0FFH   
04F7   B9                     CMP   C   
04F8   C4 9F 06               CNZ   CPUER   ;TEST "DCX" B
04FB   BB                     CMP   E   
04FC   C4 9F 06               CNZ   CPUER   ;TEST "DCX" D
04FF   BD                     CMP   L   
0500   C4 9F 06               CNZ   CPUER   ;TEST "DCX" H
0503   32 BC 06               STA   TEMP0   
0506   AF                     XRA   A   
0507   3A BC 06               LDA   TEMP0   
050A   FE FF                  CPI   0FFH   
050C   C4 9F 06               CNZ   CPUER   ;TEST "LDA" AND "STA"
050F   2A BA 06               LHLD   TEMPP   
0512   22 BC 06               SHLD   TEMP0   
0515   3A BA 06               LDA   TEMPP   
0518   47                     MOV   B,A   
0519   3A BC 06               LDA   TEMP0   
051C   B8                     CMP   B   
051D   C4 9F 06               CNZ   CPUER   ;TEST "LHLD" AND "SHLD"
0520   3A BB 06               LDA   TEMPP+1   
0523   47                     MOV   B,A   
0524   3A BD 06               LDA   TEMP0+1   
0527   B8                     CMP   B   
0528   C4 9F 06               CNZ   CPUER   ;TEST "LHLD" AND "SHLD"
052B   3E AA                  MVI   A,0AAH   
052D   32 BC 06               STA   TEMP0   
0530   44                     MOV   B,H   
0531   4D                     MOV   C,L   
0532   AF                     XRA   A   
0533   0A                     LDAX   B   
0534   FE AA                  CPI   0AAH   
0536   C4 9F 06               CNZ   CPUER   ;TEST "LDAX" B
0539   3C                     INR   A   
053A   02                     STAX   B   
053B   3A BC 06               LDA   TEMP0   
053E   FE AB                  CPI   0ABH   
0540   C4 9F 06               CNZ   CPUER   ;TEST "STAX" B
0543   3E 77                  MVI   A,077H   
0545   32 BC 06               STA   TEMP0   
0548   2A BA 06               LHLD   TEMPP   
054B   11 00 00               LXI   D,00000H   
054E   EB                     XCHG   
054F   AF                     XRA   A   
0550   1A                     LDAX   D   
0551   FE 77                  CPI   077H   
0553   C4 9F 06               CNZ   CPUER   ;TEST "LDAX" D AND "XCHG"
0556   AF                     XRA   A   
0557   84                     ADD   H   
0558   85                     ADD   L   
0559   C4 9F 06               CNZ   CPUER   ;TEST "XCHG"
055C   3E CC                  MVI   A,0CCH   
055E   12                     STAX   D   
055F   3A BC 06               LDA   TEMP0   
0562   FE CC                  CPI   0CCH   
0564   12                     STAX   D   
0565   3A BC 06               LDA   TEMP0   
0568   FE CC                  CPI   0CCH   
056A   C4 9F 06               CNZ   CPUER   ;TEST "STAX" D
056D   21 77 77               LXI   H,07777H   
0570   29                     DAD   H   
0571   3E EE                  MVI   A,0EEH   
0573   BC                     CMP   H   
0574   C4 9F 06               CNZ   CPUER   ;TEST "DAD" H
0577   BD                     CMP   L   
0578   C4 9F 06               CNZ   CPUER   ;TEST "DAD" H
057B   21 55 55               LXI   H,05555H   
057E   01 FF FF               LXI   B,0FFFFH   
0581   09                     DAD   B   
0582   3E 55                  MVI   A,055H   
0584   D4 9F 06               CNC   CPUER   ;TEST "DAD" B
0587   BC                     CMP   H   
0588   C4 9F 06               CNZ   CPUER   ;TEST "DAD" B
058B   3E 54                  MVI   A,054H   
058D   BD                     CMP   L   
058E   C4 9F 06               CNZ   CPUER   ;TEST "DAD" B
0591   21 AA AA               LXI   H,0AAAAH   
0594   11 33 33               LXI   D,03333H   
0597   19                     DAD   D   
0598   3E DD                  MVI   A,0DDH   
059A   BC                     CMP   H   
059B   C4 9F 06               CNZ   CPUER   ;TEST "DAD" D
059E   BD                     CMP   L   
059F   C4 9F 06               CNZ   CPUER   ;TEST "DAD" B
05A2   37                     STC   
05A3   D4 9F 06               CNC   CPUER   ;TEST "STC"
05A6   3F                     CMC   
05A7   DC 9F 06               CC   CPUER   ;TEST "CMC
05AA   3E AA                  MVI   A,0AAH   
05AC   2F                     CMA   
05AD   FE 55                  CPI   055H   
05AF   C4 9F 06               CNZ   CPUER   ;TEST "CMA"
05B2   B7                     ORA   A   ;RE-SET AUXILIARY CARRY
05B3   27                     DAA   
05B4   FE 55                  CPI   055H   
05B6   C4 9F 06               CNZ   CPUER   ;TEST "DAA"
05B9   3E 88                  MVI   A,088H   
05BB   87                     ADD   A   
05BC   27                     DAA   
05BD   FE 76                  CPI   076H   
05BF   C4 9F 06               CNZ   CPUER   ;TEST "DAA"
05C2   AF                     XRA   A   
05C3   3E AA                  MVI   A,0AAH   
05C5   27                     DAA   
05C6   D4 9F 06               CNC   CPUER   ;TEST "DAA"
05C9   FE 10                  CPI   010H   
05CB   C4 9F 06               CNZ   CPUER   ;TEST "DAA"
05CE   AF                     XRA   A   
05CF   3E 9A                  MVI   A,09AH   
05D1   27                     DAA   
05D2   D4 9F 06               CNC   CPUER   ;TEST "DAA"
05D5   C4 9F 06               CNZ   CPUER   ;TEST "DAA"
05D8   37                     STC   
05D9   3E 42                  MVI   A,042H   
05DB   07                     RLC   
05DC   DC 9F 06               CC   CPUER   ;TEST "RLC" FOR RE-SET CARRY
05DF   07                     RLC   
05E0   D4 9F 06               CNC   CPUER   ;TEST "RLC" FOR SET CARRY
05E3   FE 09                  CPI   009H   
05E5   C4 9F 06               CNZ   CPUER   ;TEST "RLC" FOR ROTATION
05E8   0F                     RRC   
05E9   D4 9F 06               CNC   CPUER   ;TEST "RRC" FOR SET CARRY
05EC   0F                     RRC   
05ED   FE 42                  CPI   042H   
05EF   C4 9F 06               CNZ   CPUER   ;TEST "RRC" FOR ROTATION
05F2   17                     RAL   
05F3   17                     RAL   
05F4   D4 9F 06               CNC   CPUER   ;TEST "RAL" FOR SET CARRY
05F7   FE 08                  CPI   008H   
05F9   C4 9F 06               CNZ   CPUER   ;TEST "RAL" FOR ROTATION
05FC   1F                     RAR   
05FD   1F                     RAR   
05FE   DC 9F 06               CC   CPUER   ;TEST "RAR" FOR RE-SET CARRY
0601   FE 02                  CPI   002H   
0603   C4 9F 06               CNZ   CPUER   ;TEST "RAR" FOR ROTATION
0606   01 34 12               LXI   B,01234H   
0609   11 AA AA               LXI   D,0AAAAH   
060C   21 55 55               LXI   H,05555H   
060F   AF                     XRA   A   
0610   C5                     PUSH   B   
0611   D5                     PUSH   D   
0612   E5                     PUSH   H   
0613   F5                     PUSH   PSW   
0614   01 00 00               LXI   B,00000H   
0617   11 00 00               LXI   D,00000H   
061A   21 00 00               LXI   H,00000H   
061D   3E C0                  MVI   A,0C0H   
061F   C6 F0                  ADI   0F0H   
0621   F1                     POP   PSW   
0622   E1                     POP   H   
0623   D1                     POP   D   
0624   C1                     POP   B   
0625   DC 9F 06               CC   CPUER   ;TEST "PUSH PSW" AND "POP PSW"
0628   C4 9F 06               CNZ   CPUER   ;TEST "PUSH PSW" AND "POP PSW"
062B   E4 9F 06               CPO   CPUER   ;TEST "PUSH PSW" AND "POP PSW"
062E   FC 9F 06               CM   CPUER   ;TEST "PUSH PSW" AND "POP PSW"
0631   3E 12                  MVI   A,012H   
0633   B8                     CMP   B   
0634   C4 9F 06               CNZ   CPUER   ;TEST "PUSH B" AND "POP B"
0637   3E 34                  MVI   A,034H   
0639   B9                     CMP   C   
063A   C4 9F 06               CNZ   CPUER   ;TEST "PUSH B" AND "POP B"
063D   3E AA                  MVI   A,0AAH   
063F   BA                     CMP   D   
0640   C4 9F 06               CNZ   CPUER   ;TEST "PUSH D" AND "POP D"
0643   BB                     CMP   E   
0644   C4 9F 06               CNZ   CPUER   ;TEST "PUSH D" AND "POP D"
0647   3E 55                  MVI   A,055H   
0649   BC                     CMP   H   
064A   C4 9F 06               CNZ   CPUER   ;TEST "PUSH H" AND "POP H"
064D   BD                     CMP   L   
064E   C4 9F 06               CNZ   CPUER   ;TEST "PUSH H" AND "POP H"
0651   21 00 00               LXI   H,00000H   
0654   39                     DAD   SP   
0655   22 C1 06               SHLD   SAVSTK   ;SAVE THE "OLD" STACK-POINTER!
0658   31 C0 06               LXI   SP,TEMP4   
065B   3B                     DCX   SP   
065C   3B                     DCX   SP   
065D   33                     INX   SP   
065E   3B                     DCX   SP   
065F   3E 55                  MVI   A,055H   
0661   32 BE 06               STA   TEMP2   
0664   2F                     CMA   
0665   32 BF 06               STA   TEMP3   
0668   C1                     POP   B   
0669   B8                     CMP   B   
066A   C4 9F 06               CNZ   CPUER   ;TEST "LXI","DAD","INX",AND "DCX" SP
066D   2F                     CMA   
066E   B9                     CMP   C   
066F   C4 9F 06               CNZ   CPUER   ;TEST "LXI","DAD","INX", AND "DCX" SP
0672   21 C0 06               LXI   H,TEMP4   
0675   F9                     SPHL   
0676   21 33 77               LXI   H,07733H   
0679   3B                     DCX   SP   
067A   3B                     DCX   SP   
067B   E3                     XTHL   
067C   3A BF 06               LDA   TEMP3   
067F   FE 77                  CPI   077H   
0681   C4 9F 06               CNZ   CPUER   ;TEST "SPHL" AND "XTHL"
0684   3A BE 06               LDA   TEMP2   
0687   FE 33                  CPI   033H   
0689   C4 9F 06               CNZ   CPUER   ;TEST "SPHL" AND "XTHL"
068C   3E 55                  MVI   A,055H   
068E   BD                     CMP   L   
068F   C4 9F 06               CNZ   CPUER   ;TEST "SPHL" AND "XTHL"
0692   2F                     CMA   
0693   BC                     CMP   H   
0694   C4 9F 06               CNZ   CPUER   ;TEST "SPHL" AND "XTHL"
0697   2A C1 06               LHLD   SAVSTK   ;RESTORE THE "OLD" STACK-POINTER
069A   F9                     SPHL   
069B   21 B1 06               LXI   H,CPUOK   
069E   E9                     PCHL   ;TEST "PCHL"
069F                          ; 
069F                          ; 
069F                          ; 
069F   21 9F 01     CPUER:    LXI   H,NGCPU   ;OUTPUT "CPU HAS FAILED    ERROR EXIT=" TO CONSOLE
06A2   CD 52 01               CALL   MSG   
06A5   E3                     XTHL   
06A6   7C                     MOV   A,H   
06A7   CD 6A 01               CALL   BYTEO   ;SHOW ERROR EXIT ADDRESS HIGH BYTE
06AA   7D                     MOV   A,L   
06AB   CD 6A 01               CALL   BYTEO   ;SHOW ERROR EXIT ADDRESS LOW BYTE
06AE   C3 4F 01               JMP   WBOOT   ;EXIT TO CP/M WARM BOOT
06B1                          ; 
06B1                          ; 
06B1                          ; 
06B1   21 8A 01     CPUOK:    LXI   H,OKCPU   ;OUTPUT "CPU IS OPERATIONAL" TO CONSOLE
06B4   CD 52 01               CALL   MSG   
06B7   C3 4F 01               JMP   WBOOT   ;EXIT TO CP/M WARM BOOT
06BA                          ; 
06BA                          ; 
06BA                          ; 
06BA   BC 06        TEMPP:    DW   TEMP0   ;POINTER USED TO TEST "LHLD","SHLD",
06BC                          ; AND "LDAX" INSTRUCTIONS
06BC                          ; 
06BC                TEMP0:    DS   1   ;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
06BD                TEMP1:    DS   1   ;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
06BE                TEMP2:    DS   1   
06BF                TEMP3:    DS   1   ;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
06C0                TEMP4:    DS   1   ;TEMPORARY STORAGE FOR CPU TEST MEMORY LOCATIONS
06C1                SAVSTK:   DS   2   ;TEMPORARY STACK-POINTER STORAGE LOCATION
06C3                          ; 
06C3                          ; 
06C3                          ; 
06C3                STACK:    EQU   TEMPP+256   
06C3                          ; 


_PC         06C3
LOLZ        0109
BDOS        0005
WBOOT       014F
MSG         0152
PCHAR       015D
BYTEO       016A
BYTO1       017A
BYTO2       017E
BYTO3       0187
OKCPU       018A
NGCPU       019F
CPU         01C1
J010        01CC
J020        01D2
J030        01D8
J040        01DE
J050        01ED
J060        01F0
J070        01F8
J080        0201
J090        0204
J100        020C
J110        0215
J120        0218
J130        0220
J140        0229
J150        022C
J160        0234
J170        023D
AIMM        0240
CPIE        0258
ACII        025B
SUII        0267
SBII        0273
ANII        027F
ORII        0289
XRII        0293
C010        029D
C020        02B3
C030        02C9
CPOI        02D6
CPEI        02E2
CMI         02EE
TCPI        02FA
CNCI        0306
CCI         0312
CNZI        031E
CZI         032A
MOVI        0333
CPUER       069F
CPUOK       06B1
TEMPP       06BA
TEMP0       06BC
TEMP1       06BD
TEMP2       06BE
TEMP3       06BF
TEMP4       06C0
SAVSTK      06C1
STACK       07BA
