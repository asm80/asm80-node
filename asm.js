var ASM={};!function(e,n){"undefined"!=typeof module?module.exports=n():"function"==typeof define&&"object"==typeof define.amd?define(n):this.ASM=n()}(0,function(){"use strict";var e=null,n=null,o={},r=!1,a=require("./parser.js").Parser,l=function(e){return e.map(function(e){var n=e.line;for(n=(n=n.replace("&lt;","<")).replace("&gt;",">");" "==n[n.length-1];)n=n.substr(0,n.length-1);if(e.line=n," "!=n[0])return e;for(;" "==n[0];)n=n.substr(1);return e.line=" "+n,e})},t=function(e){return e.filter(function(e){for(var n=e.line;" "==n[0];)n=n.substr(1);return!!n.length})},s=function(e){return e.map(function(e){for(var n=e.line,o={addr:0,line:";;;EMPTYLINE",numline:e.numline};" "==n[0];)n=n.substr(1);return n.length?e:o})},i=function(e){var n=1;return e.map(function(e){return{line:e,numline:n++,addr:null,bytes:0}})},p=function(e){return e.replace(/^\s+|\s+$/g,"")},f=function(n,o,r,a){var l=n.line,t=l.match(/^\s*(\@{0,1}[a-zA-Z0-9-_]+):\s*(.*)/);t&&(n.label=t[1].toUpperCase(),l=t[2]);var s=l.match(/^\s*(\=)\s*(.*)/);if(s?(n.opcode=s[1].toUpperCase(),l=s[2]):(s=l.match(/^\s*([\.a-zA-Z0-9-_]+)\s*(.*)/))&&(n.opcode=s[1].toUpperCase(),l=s[2]),l){for(;l.match(/"(.*?);(.*?)"/g);)l=l.replace(/"(.*?);(.*?)"/g,'"$1§$2"');var i=l.match(/^\s*([^;]*)(.*)/);if(i&&i[1].length){n.paramstring=i[1];for(var c=i[1];c.match(/"(.*?),(.*?)"/g);)c=c.replace(/"(.*?),(.*?)"/g,'"$1€$2"');var d=c.match(/([0-9]+)\s*DUP\s*\((.*)\)/i);if(d){for(var u=parseInt(d[1]),h="",m=0;m<u;m++)h+=d[2]+",";c=h.substring(0,h.length-1)}var g=c.split(/\s*,\s*/);n.params=g.map(function(e){return p(e.replace(/€/g,",").replace(/§/g,";"))}),l=i[2].replace(/§/g,";")}}if(l){var v=l.match(/^\s*;*(.*)/);v&&(n.remark=v[1],n.remark||(n.remark=" "),l="")}if(n.notparsed=l,"ORG"===n.opcode&&(n.opcode=".ORG"),".ERROR"===n.opcode)throw{msg:n.paramstring,s:n};if(".EQU"===n.opcode&&(n.opcode="EQU"),".ORG"===n.opcode)try{return n}catch(e){throw{msg:e.message,s:n}}if("DEFB"===n.opcode)return n.opcode="DB",n;if(".DB"===n.opcode)return n.opcode="DB",n;if(".DW"===n.opcode)return n.opcode="DW",n;if("DEFW"===n.opcode)return n.opcode="DW",n;if("DEFS"===n.opcode)return n.opcode="DS",n;if("DEFM"===n.opcode)return n.opcode="DS",n;if(".ALIGN"===n.opcode)return n.opcode="ALIGN",n;if("EQU"===n.opcode||"="===n.opcode||"IF"===n.opcode||"IFN"===n.opcode||"ENDIF"===n.opcode||".INCLUDE"===n.opcode||".INCBIN"===n.opcode||".MACRO"===n.opcode||".ENDM"===n.opcode||".BLOCK"===n.opcode||".ENDBLOCK"===n.opcode||".REPT"===n.opcode||".CPU"===n.opcode||".ENT"===n.opcode||".ENGINE"===n.opcode||".PRAGMA"===n.opcode||"END"===n.opcode||".END"===n.opcode||"BSZ"===n.opcode||"FCB"===n.opcode||"FCC"===n.opcode||"FDB"===n.opcode||"FILL"===n.opcode||"RMB"===n.opcode||"ZMB"===n.opcode||".M8"===n.opcode||".X8"===n.opcode||".M16"===n.opcode||".X16"===n.opcode||".PHASE"===n.opcode||".DEPHASE"===n.opcode||"ALIGN"===n.opcode||".CSTR"===n.opcode||".ISTR"===n.opcode||".PSTR"===n.opcode||".CSEG"===n.opcode||".DSEG"===n.opcode||".ESEG"===n.opcode||".BSSEG"===n.opcode||"DB"===n.opcode||"DS"===n.opcode||"DW"===n.opcode)return n;if(!n.opcode&&n.label)return n;try{var M=e.parseOpcode(n)}catch(e){throw{msg:e,s:n}}if(null!==M)return M;if(o[n.opcode])return n.macro=n.opcode,n;if(!n.label&&!r){var E={line:n.line,numline:n.numline,addr:null,bytes:0};if(n.remark&&!n.opcode)return n;if(!n.params)throw{msg:"Unrecognized instruction "+n.opcode,s:n};if(!n.opcode)throw{msg:"Unrecognized instruction "+n.opcode,s:n};E.line=n.opcode+": "+n.params.join();var A=f(E,o,!0,n);if(!A.opcode)throw{msg:"Unrecognized instruction "+n.opcode,s:n};return A}if(r)throw{msg:"Unrecognized instruction "+a.opcode,s:n};throw{msg:"Unrecognized instruction "+n.opcode,s:n}},c=function(e){for(var r,s,f=null,d={},u=null,h=null,m=[],g=0,v=e.length;g<v;g++)if(r=e[g].line,s=r.match(/\s*(\.[^\s]+)(.*)/)){var M=s[1].toUpperCase(),E=s[2].match(/^\s*([^;]*)(.*)/);if(E&&E[1].length?(E[1],f=E[1].split(/\s*,\s*/).map(p)):f=null,".INCLUDE"!==M)if(".ENDM"!==M)if(".MACRO"!==M)if(".REPT"!==M)m.push(e[g]);else{if(!f[0])throw{msg:"No repeat count given",s:e[g]};if(!(h=a.evaluate(f[0])))throw{msg:"Bad repeat count given",s:e[g]};if(u="*REPT"+e[g].numline,d[u])throw{msg:"Macro redefinition at line "+e[g].numline,s:e[g]};d[u]=[]}else{if(!f[0])throw{msg:"Bad macro name at line "+e[g].numline,s:e[g]};if(u=f[0].toUpperCase(),d[u])throw{msg:"Macro redefinition at line "+e[g].numline,s:e[g]};d[u]=[]}else{if(!u)throw{msg:"ENDM without MACRO at line "+e[g].numline,s:e[g]};if(h){m.push({numline:e[g].numline,line:";rept unroll",addr:null,bytes:0,remark:"REPT unroll"});for(var A=0;A<h;A++)for(var b=0;b<d[u].length;b++){var S=d[u][b].line;m.push({numline:e[A].numline,line:S,addr:null,bytes:0})}}u=null,h=null}else{if(!f[0])throw{msg:"No file name given at line "+r.numline,s:r};if(o[f[0].replace(/\"/g,"")])throw{msg:"File "+f[0].replace(/\"/g,"")+" is already included elsewhere - maybe recursion at line "+r.numline,s:r};var y=n(f[0].replace(/\"/g,"")),C=i(y.split(/\n/));C=t(C),C=l(C);for(var N=c(C),D=0;D<N[0].length;D++)N[0][D].includedFile=f[0].replace(/\"/g,""),m.push(N[0][D]);for(D in N[1])d[D]=N[1][D];o[f[0].replace(/\"/g,"")]=y}}else{if(u){d[u].push(e[g]);continue}m.push(e[g])}if(u)throw{msg:"MACRO "+u+" has no appropriate ENDM",s:e[g]};return[m,d]},d=function(e,n){for(var o={line:e.line,addr:e.addr,macro:e.macro,numline:e.numline},r=0;r<n.length;r++)o.line=o.line.replace("%%"+(r+1),n[r]);return o},u=function(e,n){for(var o=[],r=0;r<e.length;r++){var a=e[r];if(a.macro)for(var l=n[a.macro],t=0;t<l.length;t++){var s=f(d(l[t],a.params),n);a.label&&(s.label=a.label),a.label="",s.remark=a.remark,s.macro=a.macro,a.macro=null,a.remark="",o.push(s)}else o.push(a)}return o},h={},m=function(e,n){for(var o=e.toString(16);o.length<n;)o="0"+o;return o.toUpperCase()},g=function(e){return m(255&e,2)},v=function(e){return m(e,4)},M=function(e){return m(e,6)},E=function(e){return"string"==typeof e?255&e.charCodeAt(0):255&e},A=function(e,n){var o=":",r=n.length,a=0;o+=g(r),o+=v(e),o+="00",a=r+Math.floor(e/256)+Math.floor(e%256);for(var l=0;l<n.length;l++)o+=g(n[l]),a+=n[l];return o+=g(256-a%256)},b=function(e,n,o){var r=0,a=[],l=16;o>1&&(l=o);for(var t="",s=0;s<n.length;s++)a.push(n[s]),++r===l&&(t+=A(e,a)+"\n",a=[],r=0,e+=l);return a.length&&(t+=A(e,a)+"\n"),t},S=function(e,n){var o="S1",r=n.length,a=0;o+=g(r+3),o+=v(e),a=r+3+Math.floor(e/256)+Math.floor(e%256);for(var l=0;l<n.length;l++)o+=g(n[l]),a+=n[l];return o+=g(256-a%256)},y=function(e,n){for(var o=0,r=[],a="",l=0;l<n.length;l++)r.push(n[l]),16==++o&&(a+=S(e,r)+"\n",r=[],o=0,e+=16);return r.length&&(a+=S(e,r)+"\n"),a},C=function(e,n){var o="S2",r=n.length,a=0;o+=g(r+4),o+=M(e),a=r+4+Math.floor(e/65536)+Math.floor(e/256)%256+Math.floor(e%256);for(var l=0;l<n.length;l++)o+=g(n[l]),a+=n[l];return o+=g(255-a%256)},N=function(e,n){for(var o=0,r=[],a="",l=0;l<n.length;l++)r.push(n[l]),16==++o&&(a+=C(e,r)+"\n",r=[],o=0,e+=16);return r.length&&(a+=C(e,r)+"\n"),a};return ASM={parse:function(n,a){e=a,a.endian&&(r=a.endian),o={};var s=i(n.split(/\n/));s=t(s),s=l(s);var p=c(s);return s=p[0].map(function(e){return f(e,p[1])}),s=u(s,p[1])},pass1:function(o,r){var l="CSEG",t=function(){if("BSSEG"===l)throw d.opcode+" is not allowed in BSSEG"},s={},i=0,p={};r&&(p=r);for(var f,c,d=null,u=0,m=[],g=0,v=0,M=o.length;v<M;v++)if(d=o[v],d.pass=1,d.segment=l,d.addr=i,p._PC=i,0!==g&&(d.phase=g),"ENDIF"!==d.opcode){if(!u)if("IF"!==d.opcode)if("IFN"!==d.opcode)if(".BLOCK"!==d.opcode)if(".ENDBLOCK"!==d.opcode){if(d.label){var E=d.label,A=!1;if("@"===E[0]&&(A=!0,E=E.substr(1),d.label=E,d.beGlobal=!0),d.beGlobal&&(A=!0),m.length>0&&(E=m.join("/")+"/"+E,p["__"+m.join("/")].push(d.label)),!r&&(p[E+"$"]||A&&void 0!==p[d.label]))throw{msg:"Redefine label "+d.label+" at line "+d.numline,s:d};p[d.label]?p[E]=p[d.label]:A&&(p[E]=i),h[d.label]={defined:{line:d.numline,file:d.includedFile||"*main*"},value:i},p[E+"$"]=i,p[d.label]=i,A&&(p[E]=i)}try{if(".ORG"===d.opcode){i=a.evaluate(d.params[0],p),d.addr=i,s[l]=i;continue}if(".CSEG"===d.opcode&&(s[l]=i,l="CSEG",d.segment=l,i=s[l]||0,d.addr=i),".DSEG"===d.opcode&&(s[l]=i,l="DSEG",d.segment=l,i=s[l]||0,d.addr=i),".ESEG"===d.opcode&&(s[l]=i,l="ESEG",d.segment=l,i=s[l]||0,d.addr=i),".BSSEG"===d.opcode&&(s[l]=i,l="BSSEG",d.segment=l,i=s[l]||0,d.addr=i),".PHASE"===d.opcode){var b=a.evaluate(d.params[0],p);d.addr=i,g=b-i,i=b;continue}if(".DEPHASE"===d.opcode){d.addr=i,i-=g,g=0;continue}if("EQU"===d.opcode){try{p[d.label]=a.evaluate(d.params[0],p)}catch(e){p[d.label]=null}h[d.label]={defined:{line:d.numline,file:d.includedFile||"*main*"},value:p[d.label]};continue}if("="===d.opcode){p[d.label]=a.evaluate(d.params[0],p),h[d.label]={defined:{line:d.numline,file:d.includedFile||"*main*"},value:p[d.label]};continue}}catch(e){throw{msg:e.message,s:d}}if("DB"===d.opcode||"FCB"===d.opcode)for(t(),d.bytes=0,c=0;c<d.params.length;c++)try{if("number"==typeof(f=a.evaluate(d.params[c],p))){d.bytes++;continue}if("string"==typeof f){d.bytes+=f.length;continue}}catch(e){d.bytes++}if(".CSTR"===d.opcode||".PSTR"===d.opcode||".ISTR"===d.opcode){for(t(),d.bytes=0,c=0;c<d.params.length;c++)try{if("number"==typeof(f=a.evaluate(d.params[c],p))){d.bytes++;continue}if("string"==typeof f){d.bytes+=f.length;continue}}catch(e){d.bytes++}".CSTR"!==d.opcode&&".PSTR"!==d.opcode||d.bytes++}if("DS"!==d.opcode&&"RMB"!==d.opcode)if("ALIGN"!==d.opcode)if("FILL"!==d.opcode)if("BSZ"!==d.opcode&&"ZMB"!==d.opcode){if("DW"===d.opcode||"FDB"===d.opcode)for(t(),d.bytes=0,c=0;c<d.params.length;c++)try{if("number"==typeof(f=a.evaluate(d.params[c],p))){d.bytes+=2;continue}}catch(e){d.bytes+=2}if(".INCBIN"!==d.opcode)if(".M16"!==d.opcode)if(".M8"!==d.opcode)if(".X16"!==d.opcode)if(".X8"!==d.opcode){var S=e.parseOpcode(o[v],p);S&&(t(),d=S),i+=d.bytes}else p.__MX=8;else p.__MX=16;else p.__AX=8;else p.__AX=16;else{if(t(),!d.params[0])throw{msg:"No file name given at line "+d.numline,s:d};var y=n(d.params[0],!0);if(!y)throw{msg:"Cannot find file "+d.params[0]+" for incbin",s:d};for(d.bytes=0,d.lens=[],G=0;G<y.length;G++){var C=y.charCodeAt(G);C>255&&(d.lens[d.bytes++]=C>>8),d.lens[d.bytes++]=C%256}i+=d.bytes}}else{for(t(),D=a.evaluate(d.params[0],p),d.bytes=D,d.lens=[],G=0;G<D;G++)d.lens[G]=0;i+=D}else{for(t(),D=a.evaluate(d.params[1],p),"string"==typeof(f=a.evaluate(d.params[0],p))&&(f=f.charCodeAt(0)),d.bytes=D,d.lens=[],G=0;G<D;G++)d.lens[G]=f;i+=D}else{var N=a.evaluate(d.params[0],p);i+=i%N>0?N-i%N:0}else{var D=a.evaluate(d.params[0],p);if(2==d.params.length){"string"==typeof(f=a.evaluate(d.params[1],p))&&(f=f.charCodeAt(0)),d.bytes=D,d.lens=[];for(var G=0;G<D;G++)d.lens[G]=f}i+=D}}else{for(var R=p["__"+m.join("/")],B=0;B<R.length;B++)p[R[B]]=p[m.join("/")+"/"+R[B]],p[m.join("/")+"/"+R[B]]=null;m.pop(),p.__blocks=JSON.stringify(m)}else{m.push(d.numline);var I=m.join("/");p["__"+I]=[]}else try{a.evaluate(d.params[0],p)&&(u=1)}catch(e){}else try{a.evaluate(d.params[0],p)||(u=1)}catch(e){u=1}}else u=0;return[o,p]},pass2:function(e){for(var n,o,l,t=e[0],s=e[1],i=null,p=null,f=[],c=0,d=t.length;c<d;c++)try{(i=t[c]).pass=2,s._PC=i.addr;try{for(var u=a.usage(i.params[0].toUpperCase(),s),m=0;m<u.length;m++)h[u[m]].usage||(h[u[m]].usage=[]),h[u[m]].usage.push({line:i.numline,file:i.includedFile||"*main*"})}catch(e){}try{for(var u=a.usage(i.params[1].toUpperCase(),s),m=0;m<u.length;m++)h[u[m]].usage||(h[u[m]].usage=[]),h[u[m]].usage.push({line:i.numline,file:i.includedFile||"*main*"})}catch(e){}if(".BLOCK"===i.opcode){f.push(i.numline);for(var g=s["__"+f.join("/")],v=0;v<g.length;v++)s[f.join("/")+"/"+g[v]]=s[g[v]],s[g[v]]=s[f.join("/")+"/"+g[v]+"$"];continue}if(".ENDBLOCK"===i.opcode){for(var g=s["__"+f.join("/")],v=0;v<g.length;v++)s[g[v]]=s[f.join("/")+"/"+g[v]],void 0===s[g[v]]&&delete s[g[v]],s[f.join("/")+"/"+g[v]]=null;f.pop();continue}if(".ENT"===i.opcode){ASM.ENT=a.evaluate(i.params[0],s);continue}if(".ENGINE"===i.opcode){ASM.ENGINE=i.params[0];continue}if(".PRAGMA"===i.opcode){ASM.PRAGMAS=ASM.PRAGMAS||[],ASM.PRAGMAS.push(i.params[0].toUpperCase());continue}if("EQU"===i.opcode){s[i.label]=a.evaluate(i.params[0],s);continue}if("DB"===i.opcode||"FCB"===i.opcode){for(o=0,i.lens=[],l=0;l<i.params.length;l++)if("number"!=typeof(n=a.evaluate(i.params[l],s)))if("string"!=typeof n);else for(M=0;M<n.length;M++)i.lens[o++]=n.charCodeAt(M);else i.lens[o++]=Math.floor(n%256);continue}if(".CSTR"===i.opcode){for(o=0,i.lens=[],l=0;l<i.params.length;l++)if("number"!=typeof(n=a.evaluate(i.params[l],s)))if("string"!=typeof n);else for(M=0;M<n.length;M++)i.lens[o++]=n.charCodeAt(M);else i.lens[o++]=Math.floor(n%256);i.lens[o++]=0;continue}if(".PSTR"===i.opcode){for(o=1,i.lens=[],l=0;l<i.params.length;l++)if("number"!=typeof(n=a.evaluate(i.params[l],s)))if("string"!=typeof n);else for(M=0;M<n.length;M++)i.lens[o++]=n.charCodeAt(M);else i.lens[o++]=Math.floor(n%256);i.lens[0]=o-1;continue}if(".ISTR"===i.opcode){for(o=0,i.lens=[],l=0;l<i.params.length;l++)if("number"!=typeof(n=a.evaluate(i.params[l],s)))if("string"!=typeof n);else for(var M=0;M<n.length;M++)i.lens[o++]=127&n.charCodeAt(M);else i.lens[o++]=Math.floor(n%128);i.lens[o-1]=128|i.lens[o-1];continue}if("DW"===i.opcode||"FDB"===i.opcode){for(o=0,i.lens=[],l=0;l<i.params.length;l++)"number"!=typeof(n=a.evaluate(i.params[l],s))||(r?(i.lens[o++]=Math.floor(n/256),i.lens[o++]=Math.floor(n%256)):(i.lens[o++]=Math.floor(n%256),i.lens[o++]=Math.floor(n/256)));continue}if(i.lens&&i.lens[1]&&"function"==typeof i.lens[1]&&("addr24"===i.lens[2]?(p=i.lens[1](s),r?(i.lens[3]=Math.floor(p%256),i.lens[2]=Math.floor((p>>8)%256),i.lens[1]=Math.floor(p>>16&255)):(i.lens[1]=Math.floor(p%256),i.lens[2]=Math.floor((p>>8)%256),i.lens[3]=Math.floor(p>>16&255))):null===i.lens[2]?"string"==typeof(p=i.lens[1](s))?r?(i.lens[1]=255&p.charCodeAt(0),i.lens[2]=255&p.charCodeAt(1)):(i.lens[2]=255&p.charCodeAt(0),i.lens[1]=255&p.charCodeAt(1)):r?(i.lens[2]=Math.floor(p%256),i.lens[1]=Math.floor(p/256)):(i.lens[1]=Math.floor(p%256),i.lens[2]=Math.floor(p/256)):(p=i.lens[1](s),i.lens[1]=E(p))),i.lens&&i.lens.length>2&&"function"==typeof i.lens[2]&&(p=i.lens[2](s),null===i.lens[3]?"string"==typeof(p=i.lens[2](s))?r?(i.lens[2]=255&p.charCodeAt(0),i.lens[3]=255&p.charCodeAt(1)):(i.lens[3]=255&p.charCodeAt(0),i.lens[2]=255&p.charCodeAt(1)):r?(i.lens[3]=255&p,i.lens[2]=p>>8):(i.lens[2]=255&p,i.lens[3]=p>>8):i.lens[2]=E(p)),i.lens&&i.lens.length>3&&"function"==typeof i.lens[3]&&(p=i.lens[3](s),null===i.lens[4]?"string"==typeof(p=i.lens[3](s))?r?(i.lens[3]=255&p.charCodeAt(0),i.lens[4]=255&p.charCodeAt(1)):(i.lens[4]=255&p.charCodeAt(0),i.lens[3]=255&p.charCodeAt(1)):r?(i.lens[4]=255&p,i.lens[3]=p>>8):(i.lens[3]=255&p,i.lens[4]=p>>8):i.lens[3]=E(p)),i.lens&&i.lens.length>1){if("string"==typeof i.lens[1]&&(i.lens[1]=i.lens[1].charCodeAt(0)),isNaN(i.lens[1]))throw{message:"param out of bounds, NaN"};if(i.lens[1]>255||i.lens[1]<-128)throw{message:"param out of bounds - "+i.lens[1]};i.lens[1]<0&&(i.lens[1]=256+i.lens[1])}}catch(e){throw{msg:e.message,s:i,e:e}}return[t,s]},parseLine:f,ENT:null,compile:function(e,n){try{ASM.ENT=null,ASM.ENGINE=null,ASM.PRAGMAS=[];var o=ASM.parse(e,n);h={};var r=ASM.pass1(o);return r=ASM.pass1(r[0],r[1]),r=ASM.pass1(r[0],r[1]),r=ASM.pass1(r[0],r[1]),r=ASM.pass1(r[0],r[1]),r=ASM.pass1(r[0],r[1]),r=ASM.pass1(r[0],r[1]),r=ASM.pass2(r),[null,r,h]}catch(e){return[e,null]}},compileAsync:function(e,n,o){try{var r=ASM.parse(e,n),a=ASM.pass1(r);a=ASM.pass2(a),o(null,a)}catch(e){o(e,null)}},lst:function(e,n,o,r,a){var l,t,s="";void 0===r&&(r=!1);for(var i=0,p=e.length;i<p;i++){if(t=e[i],l="",t.macro&&!o&&(l+="        **MACRO UNROLL - "+t.macro+"\n"),void 0!==t.addr&&(l+=v(t.addr),t.phase&&(l+=" @"+v(t.addr-t.phase)),l+=r?" ":"   "),t.lens)for(var f=0;f<t.lens.length;f++)l+=g(t.lens[f])+" ";if(!r)for(;l.length<20;)l+=" ";if(r)for(;l.length<15;)l+=" ";if(t.label&&(l+=t.label+":   "),!r)for(;l.length<30;)l+=" ";if(r)for(;l.length<22;)l+=" ";t.opcode&&(l+=t.opcode+(r?" ":"   ")),t.params&&(l+=t.params+(r?" ":"   ")),t.remark&&(l+=";"+t.remark),s+=l+"\n"}if(o)return s;s+="\n\n";for(var c in h)if(null!==h[c]&&("_"!=c[0]||"_"!=c[1])&&"$"!==c[c.length-1]){for(l="",l+=c;l.length<12;)l+=" ";if(l+=v(h[c].value),l+=" DEFINED AT LINE "+h[c].defined.line,"*main*"!=h[c].defined.file&&(l+=" IN "+h[c].defined.file),s+=l+"\n",h[c].usage)for(p=0;p<h[c].usage.length;p++)s+="            USED AT LINE "+h[c].usage[p].line,"*main*"!=h[c].usage[p].file&&(s+=" IN "+h[c].usage[p].file),s+="\n"}return s},html:function(e,n,o,r){var a,l,t="<html><head><meta charset=utf-8><body><table>";void 0===r&&(r=!1);for(var s=0,i=e.length;s<i;s++){if(l=e[s],a='<tr id="ln'+l.numline+'">',l.macro&&!o&&(a+="        **MACRO UNROLL - "+l.macro+"\n"),void 0!==l.addr?(a+='<td><a name="ADDR'+v(l.addr)+'">'+v(l.addr)+"</a>",l.phase?a+="</td><td>"+v(l.addr-l.phase):a+="</td><td>",a+="</td>"):a+="<td></td><td></td>",l.lens){a+="<td>";for(var p=0;p<l.lens.length;p++)a+=g(l.lens[p])+" ";a+="</td>"}else a+="<td></td>";l.label?a+='<td><a name="LBL'+l.label+'">'+l.label+"</a></td>":a+="<td></td>",l.opcode?a+="<td>"+l.opcode+"</td>":a+="<td></td>",l.params?a+="<td>"+l.params.map(function(e){e+="";for(var o in n)if(null!==n[o]&&("_"!=o[0]||"_"!=o[1])&&"$"!==o[o.length-1]){var r=new RegExp(o,"i");if(e.match(r))return'<a href="#LBL'+o+'">'+e+"</a>"}return e})+"</td>":a+="<td></td>",l.remark?a+="<td>;"+l.remark+"</td>":a+="<td></td>",t+=a+"</tr>\n"}return t+="</table>"},hex:function(e,n){for(var o,r=null,a=0,l=[],t="",s=!1,i=16,p=0,f=e.length;p<f;p++)if(".PRAGMA"===(o=e[p]).opcode&&(2==o.params.length&&"HEXLEN"==o.params[0].toUpperCase()&&((i=parseInt(o.params[1]))<1||i>64)&&(i=16),1==o.params.length&&"SEGMENT"==o.params[0].toUpperCase()&&(s=!0)),!s||(n||(n="CSEG"),o.segment==n)){var c=o.addr;if(o.phase&&(c-=o.phase),void 0!==c&&0===a&&(r=c),c!=r+a&&(a&&(t+=b(r,l,i)),r=c,a=0,l=[]),o.lens){for(var d=0;d<o.lens.length;d++)l.push(o.lens[d]);a+=o.lens.length}}return l.length&&(t+=b(r,l,i)),t+=":00000001FF"},srec:function(e,n){for(var o,r=null,a=0,l=!1,t=[],s="",i=0,p=e.length;i<p;i++)if(".PRAGMA"===(o=e[i]).opcode&&1==o.params.length&&"SEGMENT"==o.params[0].toUpperCase()&&(l=!0),!l||(n||(n="CSEG"),o.segment==n)){var f=o.addr;if(o.phase&&(f-=o.phase),void 0!==f&&0===a&&(r=f),f!=r+a&&(a&&(s+=y(r,t)),r=f,a=0,t=[]),o.lens){for(var c=0;c<o.lens.length;c++)t.push(o.lens[c]);a+=o.lens.length}}t.length&&(s+=y(r,t));var d=ASM.ENT||0,u=3+Math.floor(d/256)+Math.floor(d%256);return s+="S903"+v(d)+g(255-u%256)},srec28:function(e,n){for(var o,r=null,a=0,l=!1,t=[],s="",i=0,p=e.length;i<p;i++)if(".PRAGMA"===(o=e[i]).opcode&&1==o.params.length&&"SEGMENT"==o.params[0].toUpperCase()&&(l=!0),!l||(n||(n="CSEG"),o.segment==n)){var f=o.addr;if(o.phase&&(f-=o.phase),void 0!==f&&0===a&&(r=f),f!=r+a&&(a&&(s+=N(r,t)),r=f,a=0,t=[]),o.lens){for(var c=0;c<o.lens.length;c++)t.push(o.lens[c]);a+=o.lens.length}}t.length&&(s+=N(r,t));var d=ASM.ENT||0,u=3+Math.floor(d/256)+Math.floor(d%256);return s+="S804"+M(d)+g(255-u%256)+"\n"},linemap:function(e){for(var n,o=[],r=0,a=e.length;r<a;r++)if((n=e[r]).lens)for(var l=0;l<n.lens.length;l++)o[n.addr+l]=r+1;return o},beautify:function(n,o){e=o;var r=i(n.split(/\n/));r=s(r),r=t(r),r=l(r);var a=c(r);r=r.map(function(e){return f(e,a[1])});for(var p,d,u="",h=0;h<r.length;h++)if(p=r[h],d="","EMPTYLINE"!=p.remark){for(p.label&&(d+=p.label,"EQU"!=p.opcode&&"="!=p.opcode&&(d+=":"),d+=" ");d.length<12;)d+=" ";for(p.opcode&&(d+=p.opcode+" ");d.length<20;)d+=" ";p.params&&(d+=p.params+" "),p.remark&&(d+=";"+p.remark),u+=d+"\n"}else u+="\n";return u},buff:function(e){for(var n,o,r=new Uint8Array(65536),a=0,l=e.length;a<l;a++)if(n=e[a],o=n.addr,n.lens)for(var t=0;t<n.lens.length;t++)r[o++]=n.lens[t];return r},fileGet:function(e){n=e}}});